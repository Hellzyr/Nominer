<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software de Nómina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F9FA; /* Gris muy claro para un look más limpio */
            overflow-x: hidden; /* Evita el scroll horizontal */
        }
        .sidebar {
            background-color: #132F63; /* Azul marino */
        }
        .main-content {
            background-color: #F8F9FA; /* Gris muy claro */
            flex-grow: 1;
        }
        .input-field {
            transition: all 0.3s ease-in-out;
            border: 1px solid #d1d5db;
        }
        .input-field:focus {
            border-color: #132F63; /* Color azul corporativo en focus */
            box-shadow: 0 0 0 2px rgba(19, 47, 99, 0.5);
            outline: none;
        }
        .active-menu-item {
            border-left: 4px solid #FABB5A; /* Borde lateral para el elemento activo */
            background-color: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="flex min-h-screen">

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar w-64 p-6 flex flex-col items-start space-y-4 shadow-xl">
        <div class="mb-8">
            <h1 class="text-3xl font-extrabold text-white">Nomina</h1>
            <h2 class="text-xs font-light text-gray-300">Software para la DIAN</h2>
        </div>
        <nav class="w-full">
            <ul class="space-y-2">
                <li>
                    <a href="#" class="flex items-center p-3 text-lg font-bold text-gray-300 hover:text-white hover:bg-white hover:bg-opacity-10 rounded-md transition-colors">
                        <!-- Icono de Dashboard -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 mr-3">
                            <rect x="3" y="3" width="7" height="9"/>
                            <rect x="14" y="3" width="7" height="5"/>
                            <rect x="14" y="12" width="7" height="5"/>
                            <rect x="3" y="16" width="7" height="5"/>
                        </svg>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center p-3 text-lg font-bold text-white rounded-md transition-colors active-menu-item">
                        <!-- Icono de Nómina -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 mr-3">
                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" x2="8" y1="13" y2="13"/>
                            <line x1="16" x2="8" y1="17" y2="17"/>
                            <line x1="10" x2="8" y1="9" y2="9"/>
                        </svg>
                        Nómina
                    </a>
                    <ul class="pl-8 mt-2 space-y-1">
                        <li><a href="#" class="block text-sm text-white hover:text-[#FABB5A] transition-colors">Generar Nómina</a></li>
                        <li><a href="#" class="block text-sm text-gray-300 hover:text-[#FABB5A] transition-colors">Historial de Nóminas</a></li>
                        <li><a href="#" class="block text-sm text-gray-300 hover:text-[#FABB5A] transition-colors">Liquidación de Contrato</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#" class="flex items-center p-3 text-lg font-bold text-gray-300 hover:text-white hover:bg-white hover:bg-opacity-10 rounded-md transition-colors">
                        <!-- Icono de Empleados -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 mr-3">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Empleados
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center p-3 text-lg font-bold text-gray-300 hover:text-white hover:bg-white hover:bg-opacity-10 rounded-md transition-colors">
                        <!-- Icono de Reportes -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 mr-3">
                            <path d="M21.54 15H17a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h4.54a1 1 0 0 1 .84 1.5l-2.43 4.54a1.72 1.72 0 0 1 0 1.92l2.43 4.54a1 1 0 0 1-.84 1.5z"/>
                            <path d="M3.5 15H8a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H3.5A1.5 1.5 0 0 0 2 6.5v8A1.5 1.5 0 0 0 3.5 15z"/>
                            <path d="M12 19V5"/>
                            <path d="M10 17l2-2"/>
                            <path d="M14 17l-2-2"/>
                        </svg>
                        Reportes
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center p-3 text-lg font-bold text-gray-300 hover:text-white hover:bg-white hover:bg-opacity-10 rounded-md transition-colors">
                        <!-- Icono de Configuración -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 mr-3">
                            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 1-2 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 1-2 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 1-2 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 1-2 2v-.44a2 2 0 0 0 2-2h.44a2 2 0 0 1 2-2v-.44a2 2 0 0 0 2-2v-.44a2 2 0 0 1-2-2v-.44a2 2 0 0 0-2-2v-.44a2 2 0 0 1-2-2h-.44a2 2 0 0 0-2-2v.44a2 2 0 0 1-2 2h.44a2 2 0 0 0 2 2h.44a2 2 0 0 1 2 2v.44a2 2 0 0 0 2 2h.44a2 2 0 0 1 2 2v.44a2 2 0 0 0 2 2h.44a2 2 0 0 1 2 2v-.44a2 2 0 0 0 2-2v-.44a2 2 0 0 1 2-2h.44a2 2 0 0 0 2-2v-.44a2 2 0 0 1 2-2v-.44a2 2 0 0 0 2-2v-.44a2 2 0 0 1-2-2v-.44a2 2 0 0 0-2-2v-.44a2 2 0 0 1-2-2h-.44a2 2 0 0 0-2-2v.44a2 2 0 0 1-2 2z"/>
                            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                        </svg>
                        Configuración
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col">
        <!-- Header -->
        <header class="bg-white p-4 sm:p-6 flex justify-between items-center shadow-md">
            <h1 class="text-4xl font-extrabold text-[#132F63]">Generar Nómina</h1>
            <div class="flex items-center space-x-4">
                <button aria-label="Notificaciones" class="text-gray-500 hover:text-[#FABB5A] transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.42 6.421 6 8.527 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                </button>
                <div aria-label="Perfil de usuario" class="h-10 w-10 rounded-full bg-[#FABB5A] flex items-center justify-center text-white font-bold">
                    UN
                </div>
            </div>
        </header>

        <!-- Content Area with Form -->
        <div class="main-content flex justify-center items-start pt-10 pb-10">
            <div class="w-full max-w-4xl bg-white p-8 sm:p-10 rounded-xl shadow-lg border border-gray-200">
                <p class="text-gray-600 mb-8 text-center text-sm sm:text-base">
                    Ingresa los datos del empleado y los conceptos de la nómina para generar el documento XML.
                </p>
                <hr class="border-gray-200 mb-8">

                <form id="nominaForm" class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8 mb-8">
                    <!-- Datos del Empleador -->
                    <div class="md:col-span-2">
                        <h2 class="text-2xl font-bold text-[#132F63] mb-4">Datos del Empleador</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <label for="nit" class="block text-sm font-medium text-gray-700">NIT de la Empresa</label>
                                <input type="text" id="nit" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 900000000" aria-label="NIT del Empleador" required>
                            </div>
                            <div>
                                <label for="razonSocial" class="block text-sm font-medium text-gray-700">Razón Social</label>
                                <input type="text" id="razonSocial" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: Hotel Ejemplo S.A.S." aria-label="Razón Social" required>
                            </div>
                        </div>
                    </div>

                    <!-- Datos del Empleado -->
                    <div>
                        <h2 class="text-2xl font-bold text-[#132F63] mb-4">Datos del Empleado</h2>
                        <div class="space-y-6">
                            <div>
                                <label for="nombreEmpleado" class="block text-sm font-medium text-gray-700">Nombre del Empleado</label>
                                <input type="text" id="nombreEmpleado" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: Juan Pérez" aria-label="Nombre del Empleado" required>
                            </div>
                            <div>
                                <label for="tipoDocumento" class="block text-sm font-medium text-gray-700">Tipo de Documento</label>
                                <select id="tipoDocumento" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" aria-label="Tipo de Documento" required>
                                    <option value="CC">Cédula de Ciudadanía (CC)</option>
                                    <option value="CE">Cédula de Extranjería (CE)</option>
                                    <option value="PA">Pasaporte (PA)</option>
                                </select>
                            </div>
                            <div>
                                <label for="identificacion" class="block text-sm font-medium text-gray-700">Número de Documento</label>
                                <input type="text" id="identificacion" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 12345678" aria-label="Número de Identificación" required>
                            </div>
                            <div>
                                <label for="cargo" class="block text-sm font-medium text-gray-700">Cargo</label>
                                <input type="text" id="cargo" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: Gerente" aria-label="Cargo del Empleado" required>
                            </div>
                            <div>
                                <label for="tipoContrato" class="block text-sm font-medium text-gray-700">Tipo de Contrato</label>
                                <select id="tipoContrato" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" aria-label="Tipo de Contrato" required>
                                    <option value="Fijo">Fijo</option>
                                    <option value="Indefinido">Indefinido</option>
                                    <option value="Servicios">Prestación de Servicios</option>
                                </select>
                            </div>
                            <div>
                                <label for="fechaInicioContrato" class="block text-sm font-medium text-gray-700">Fecha de Inicio</label>
                                <input type="date" id="fechaInicioContrato" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" aria-label="Fecha de inicio del contrato" required>
                            </div>
                            <div>
                                <label for="centroCosto" class="block text-sm font-medium text-gray-700">Centro de Costo</label>
                                <input type="text" id="centroCosto" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: Cocina Principal" aria-label="Centro de costo o dependencia" required>
                            </div>
                        </div>
                    </div>

                    <!-- Conceptos de la Nómina -->
                    <div>
                        <h2 class="text-2xl font-bold text-[#132F63] mb-4">Conceptos de Nómina</h2>
                        <div class="space-y-6">
                            <div>
                                <label for="salarioBase" class="block text-sm font-medium text-gray-700">Salario Base ($)</label>
                                <input type="number" id="salarioBase" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 1423500" aria-label="Salario Base" required>
                            </div>
                            <div>
                                <label for="diasTrabajados" class="block text-sm font-medium text-gray-700">Días Trabajados</label>
                                <input type="number" id="diasTrabajados" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 30" aria-label="Días Trabajados" required>
                            </div>
                            <div>
                                <label for="horasExtras" class="block text-sm font-medium text-gray-700">Horas Extras ($)</label>
                                <input type="number" id="horasExtras" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 50000" aria-label="Valor de horas extras">
                            </div>
                            <div>
                                <label for="comisiones" class="block text-sm font-medium text-gray-700">Comisiones ($)</label>
                                <input type="number" id="comisiones" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 100000" aria-label="Valor de comisiones">
                            </div>
                            <div>
                                <label for="bonificaciones" class="block text-sm font-medium text-gray-700">Bonificaciones ($)</label>
                                <input type="number" id="bonificaciones" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 80000" aria-label="Valor de bonificaciones">
                            </div>
                            <div>
                                <label for="libranzas" class="block text-sm font-medium text-gray-700">Libranzas ($)</label>
                                <input type="number" id="libranzas" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 20000" aria-label="Valor de libranzas">
                            </div>
                            <div>
                                <label for="retenciones" class="block text-sm font-medium text-gray-700">Retención en la Fuente ($)</label>
                                <input type="number" id="retenciones" class="mt-1 block w-full rounded-md shadow-sm p-2.5 input-field" placeholder="Ej: 15000" aria-label="Valor de retenciones">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Campos de Liquidación -->
                    <div class="md:col-span-2">
                        <h2 class="text-2xl font-bold text-[#132F63] mb-4">Resumen de Liquidación</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                            <div class="bg-blue-100 p-4 rounded-lg">
                                <span class="block text-sm font-medium text-gray-700">Total Devengado</span>
                                <span id="totalDevengadoDisplay" class="block text-2xl font-bold text-[#132F63] mt-2">$0.00</span>
                            </div>
                            <div class="bg-red-100 p-4 rounded-lg">
                                <span class="block text-sm font-medium text-gray-700">Total Deducciones</span>
                                <span id="totalDeduccionesDisplay" class="block text-2xl font-bold text-[#132F63] mt-2">$0.00</span>
                            </div>
                            <div class="bg-green-100 p-4 rounded-lg">
                                <span class="block text-sm font-medium text-gray-700">Neto a Pagar</span>
                                <span id="netoPagarDisplay" class="block text-2xl font-bold text-[#132F63] mt-2">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Botón de Envío -->
                    <div class="md:col-span-2">
                        <button type="submit" id="submitButton" class="w-full flex justify-center py-3 px-6 border border-transparent rounded-md shadow-lg text-lg font-bold text-[#132F63] bg-[#FABB5A] hover:bg-[#EAA842] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FABB5A] transition-colors">
                            Generar Nómina
                        </button>
                    </div>
                </form>

                <!-- Sección de resultados y XML -->
                <div id="resultsContainer" class="hidden">
                    <h2 class="text-2xl font-bold text-[#132F63] mb-4">Documento XML Generado</h2>
                    <pre id="xmlOutput" class="w-full bg-gray-800 text-green-400 p-4 rounded-lg overflow-x-auto text-sm sm:text-base"></pre>

                    <div class="mt-6 flex flex-col sm:flex-row gap-4">
                        <button id="copyButton" class="w-full sm:w-1/2 flex justify-center py-3 px-6 border border-transparent rounded-md shadow-sm text-lg font-bold text-white bg-[#F6554D] hover:bg-[#E6443C] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#F6554D] transition-colors">
                            Copiar XML
                        </button>
                        <button id="downloadButton" class="w-full sm:w-1/2 flex justify-center py-3 px-6 border border-transparent rounded-md shadow-sm text-lg font-bold text-white bg-[#F6554D] hover:bg-[#E6443C] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#F6554D] transition-colors">
                            Descargar XML
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notificación Toast -->
        <div id="toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-md shadow-lg text-white text-center transition-all duration-300 ease-in-out hidden">
            <span id="toast-message"></span>
        </div>
    </main>

    <script>
        // --- FUNCIÓN DE CÁLCULO DE NÓMINA ---
        function calcularNomina() {
            // Constantes (valores de referencia)
            const SALARIO_MINIMO_2025 = 1423500;
            const AUXILIO_TRANSPORTE_2025 = 200000;

            // Obtener valores del formulario
            const salarioBase = parseFloat(document.getElementById('salarioBase').value) || 0;
            const diasTrabajados = parseInt(document.getElementById('diasTrabajados').value) || 0;
            const horasExtras = parseFloat(document.getElementById('horasExtras').value) || 0;
            const comisiones = parseFloat(document.getElementById('comisiones').value) || 0;
            const bonificaciones = parseFloat(document.getElementById('bonificaciones').value) || 0;
            const libranzas = parseFloat(document.getElementById('libranzas').value) || 0;
            const retenciones = parseFloat(document.getElementById('retenciones').value) || 0;
            
            // Cálculos principales
            let sueldoDevengado = (salarioBase / 30) * diasTrabajados;
            let auxilioTransporte = (salarioBase < (SALARIO_MINIMO_2025 * 2)) ? AUXILIO_TRANSPORTE_2025 : 0;
            
            const deduccionSalud = sueldoDevengado * 0.04;
            const deduccionPension = sueldoDevengado * 0.04;

            // Totales
            const totalDevengado = sueldoDevengado + auxilioTransporte + horasExtras + comisiones + bonificaciones;
            const totalDeducciones = deduccionSalud + deduccionPension + libranzas + retenciones;
            const netoPagar = totalDevengado - totalDeducciones;

            return {
                sueldo: sueldoDevengado,
                auxilio_transporte: auxilioTransporte,
                horas_extras: horasExtras,
                comisiones: comisiones,
                bonificaciones: bonificaciones,
                salud: deduccionSalud,
                pension: deduccionPension,
                libranzas: libranzas,
                retenciones: retenciones,
                totalDevengado: totalDevengado,
                totalDeducciones: totalDeducciones,
                netoPagar: netoPagar
            };
        }
        
        // --- FUNCIÓN PARA ACTUALIZAR LOS CAMPOS DE RESUMEN ---
        function actualizarResumen() {
            const resultados = calcularNomina();
            document.getElementById('totalDevengadoDisplay').textContent = resultados.totalDevengado.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
            document.getElementById('totalDeduccionesDisplay').textContent = resultados.totalDeducciones.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
            document.getElementById('netoPagarDisplay').textContent = resultados.netoPagar.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
        }

        // --- FUNCIÓN DE GENERACIÓN DE XML ---
        function generarXML(datos) {
            const parser = new DOMParser();
            // Esto es una simplificación de la estructura UBL 2.1 de la DIAN
            const xmlDoc = parser.parseFromString("<NominaElectronica/>", "text/xml");
            const root = xmlDoc.documentElement;
            
            // Atributos de ejemplo para DIAN
            root.setAttribute("xmlns:xsi", "http://www.w3.org/2001/XMLSchema-instance");
            root.setAttribute("xmlns", "http://facturaelectronica.dian.gov.co/dian/apn");
            root.setAttribute("version", "1.0");
            root.setAttribute("periodoInicio", datos.fechaInicioContrato); // Usando fecha de inicio de contrato como proxy
            root.setAttribute("periodoFin", new Date().toISOString().slice(0, 10)); // Usando fecha actual como proxy
            root.setAttribute("numeroNomina", "1");
            
            // Datos del Empleador
            const empleador = xmlDoc.createElement("Empleador");
            empleador.setAttribute("nit", datos.nit);
            empleador.setAttribute("razonSocial", datos.razonSocial);
            root.appendChild(empleador);
            
            // Datos del Empleado
            const empleadoElem = xmlDoc.createElement("Empleado");
            empleadoElem.setAttribute("tipoDocumento", datos.tipoDocumento);
            empleadoElem.setAttribute("identificacion", datos.identificacion);
            empleadoElem.setAttribute("primerNombre", datos.nombreEmpleado);
            empleadoElem.setAttribute("cargo", datos.cargo);
            empleadoElem.setAttribute("tipoContrato", datos.tipoContrato);
            empleadoElem.setAttribute("fechaInicioContrato", datos.fechaInicioContrato);
            empleadoElem.setAttribute("centroCosto", datos.centroCosto);
            root.appendChild(empleadoElem);
            
            // Conceptos de Devengados
            const devengados = xmlDoc.createElement("Devengados");
            devengados.appendChild(xmlDoc.createElement("Sueldo")).setAttribute("valor", Math.round(datos.sueldo).toString());
            devengados.appendChild(xmlDoc.createElement("AuxilioTransporte")).setAttribute("valor", Math.round(datos.auxilio_transporte).toString());
            devengados.appendChild(xmlDoc.createElement("HorasExtras")).setAttribute("valor", Math.round(datos.horas_extras).toString());
            devengados.appendChild(xmlDoc.createElement("Comisiones")).setAttribute("valor", Math.round(datos.comisiones).toString());
            devengados.appendChild(xmlDoc.createElement("Bonificaciones")).setAttribute("valor", Math.round(datos.bonificaciones).toString());
            root.appendChild(devengados);
            
            // Conceptos de Deducciones
            const deducciones = xmlDoc.createElement("Deducciones");
            deducciones.appendChild(xmlDoc.createElement("Salud")).setAttribute("valor", Math.round(datos.salud).toString());
            deducciones.appendChild(xmlDoc.createElement("Pension")).setAttribute("valor", Math.round(datos.pension).toString());
            deducciones.appendChild(xmlDoc.createElement("Libranzas")).setAttribute("valor", Math.round(datos.libranzas).toString());
            deducciones.appendChild(xmlDoc.createElement("Retenciones")).setAttribute("valor", Math.round(datos.retenciones).toString());
            root.appendChild(deducciones);
            
            const serializer = new XMLSerializer();
            return serializer.serializeToString(xmlDoc);
        }

        // --- MANEJO DEL FORMULARIO Y VALIDACIONES ---
        document.getElementById('nominaForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const submitButton = document.getElementById('submitButton');
            submitButton.innerHTML = `
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-[#132F63]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Cargando...
            `;
            submitButton.disabled = true;

            setTimeout(() => {
                const formInputs = {
                    nit: document.getElementById('nit').value,
                    razonSocial: document.getElementById('razonSocial').value,
                    nombreEmpleado: document.getElementById('nombreEmpleado').value,
                    tipoDocumento: document.getElementById('tipoDocumento').value,
                    identificacion: document.getElementById('identificacion').value,
                    cargo: document.getElementById('cargo').value,
                    tipoContrato: document.getElementById('tipoContrato').value,
                    fechaInicioContrato: document.getElementById('fechaInicioContrato').value,
                    centroCosto: document.getElementById('centroCosto').value,
                    salarioBase: parseFloat(document.getElementById('salarioBase').value),
                    diasTrabajados: parseInt(document.getElementById('diasTrabajados').value)
                };

                // Simple validation check
                for (const key in formInputs) {
                    if (!formInputs[key] && key !== 'fechaInicioContrato') {
                         showToast(`Por favor, completa el campo '${key}'.`, "red");
                         submitButton.innerHTML = "Generar Nómina";
                         submitButton.disabled = false;
                         return;
                    }
                }
                 if (isNaN(formInputs.salarioBase) || isNaN(formInputs.diasTrabajados) || formInputs.salarioBase <= 0 || formInputs.diasTrabajados <= 0) {
                     showToast("Por favor, ingresa valores numéricos válidos (mayores a 0) para salario y días trabajados.", "red");
                     submitButton.innerHTML = "Generar Nómina";
                     submitButton.disabled = false;
                     return;
                 }


                const resultados = calcularNomina();
                
                // Actualizar la vista de resultados
                document.getElementById('totalDevengadoDisplay').textContent = resultados.totalDevengado.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
                document.getElementById('totalDeduccionesDisplay').textContent = resultados.totalDeducciones.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
                document.getElementById('netoPagarDisplay').textContent = resultados.netoPagar.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });

                const xmlString = generarXML({ ...formInputs, ...resultados });
                document.getElementById('xmlOutput').textContent = xmlString;

                document.getElementById('resultsContainer').classList.remove('hidden');
                submitButton.innerHTML = "Generar Nómina";
                submitButton.disabled = false;
                showToast("¡Nómina generada con éxito!", "green");
            }, 1000); // Simulación de carga
        });

        // Add event listeners for key inputs to update the summary in real-time
        ['salarioBase', 'diasTrabajados', 'horasExtras', 'comisiones', 'bonificaciones', 'libranzas', 'retenciones'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('input', actualizarResumen);
            }
        });

        // --- MANEJO DE BOTONES ---
        document.getElementById('copyButton').addEventListener('click', function() {
            const xmlContent = document.getElementById('xmlOutput').textContent;
            try {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = xmlContent;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextArea);
                showToast("XML copiado al portapapeles!", "green");
            } catch (err) {
                showToast("Error al intentar copiar el XML.", "red");
            }
        });

        document.getElementById('downloadButton').addEventListener('click', function() {
            const xmlContent = document.getElementById('xmlOutput').textContent;
            const filename = `nomina_${document.getElementById('identificacion').value}.xml`;
            const blob = new Blob([xmlContent], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast("XML descargado con éxito!", "green");
        });

        // --- MANEJO DE NOTIFICACIONES TOAST ---
        function showToast(message, type = "red") {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            
            toast.className = `fixed bottom-6 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-md shadow-lg text-white text-center transition-all duration-300 ease-in-out z-50`;
            toast.classList.remove('hidden');

            if (type === "green") {
                toast.style.backgroundColor = '#27AE60';
            } else {
                toast.style.backgroundColor = '#F6554D';
            }

            setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>
